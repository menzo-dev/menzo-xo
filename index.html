<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MENZO-XO: COSMIC OMNISCIENT</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="https://img.icons8.com/?size=100&id=121367&format=png&color=00f0ff">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0c14;
            --bg-light: #eef2f6;
            --primary-cyan: #00f0ff;
            --primary-pink: #ff44e0;
            --primary-gold: #ffd966;
            --primary-green: #32ffaa;
            --primary-purple: #b87cff;
            --primary-red: #ff6b6b;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #b0c4de;
            --shadow-glow: 0 0 30px rgba(0, 240, 255, 0.3);
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        [data-theme="light"] {
            --bg-dark: #f0f4fa;
            --bg-light: #ffffff;
            --primary-cyan: #0077be;
            --primary-pink: #c2185b;
            --primary-gold: #b8860b;
            --primary-green: #2e7d32;
            --primary-purple: #6a1b9a;
            --primary-red: #b71c1c;
            --glass-bg: rgba(0, 0, 0, 0.03);
            --glass-border: rgba(0, 0, 0, 0.1);
            --text-primary: #1a1f2e;
            --text-secondary: #2c3e50;
            --shadow-glow: 0 0 30px rgba(0, 119, 190, 0.2);
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: var(--transition);
            position: relative;
        }

        /* ========== COSMIC PARTICLES ========== */
        .cosmic-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .cosmic-particle {
            position: absolute;
            border-radius: 50%;
            animation: cosmicFloat 12s infinite;
            opacity: 0.7;
        }
        @keyframes cosmicFloat {
            0%, 100% { transform: translateY(0) translateX(0) scale(1); opacity: 0.7; }
            25% { transform: translateY(-25px) translateX(15px) scale(1.1); opacity: 1; }
            50% { transform: translateY(-50px) translateX(-10px) scale(0.9); opacity: 0.8; }
            75% { transform: translateY(-25px) translateX(20px) scale(1.05); opacity: 0.9; }
        }

        /* ========== GLOWING TEXT ========== */
        .glow-text {
            text-shadow: 0 0 10px var(--primary-cyan), 0 0 20px var(--primary-cyan), 0 0 30px var(--primary-cyan);
            animation: glowPulse 3s infinite;
        }
        @keyframes glowPulse {
            0% { text-shadow: 0 0 10px var(--primary-cyan), 0 0 20px var(--primary-cyan); }
            50% { text-shadow: 0 0 20px var(--primary-pink), 0 0 40px var(--primary-pink); }
            100% { text-shadow: 0 0 10px var(--primary-cyan), 0 0 20px var(--primary-cyan); }
        }

        /* Main layout */
        .app {
            display: flex;
            height: 100vh;
            position: relative;
            z-index: 10;
        }

        /* Sidebar */
        .sidebar {
            width: 380px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            position: relative;
            z-index: 100;
            box-shadow: -10px 0 30px rgba(0,0,0,0.3);
        }
        .sidebar.collapsed {
            transform: translateX(100%);
        }
        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-cyan), var(--primary-pink), var(--primary-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 5s infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .close-sidebar {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.8rem;
            cursor: pointer;
            opacity: 0.7;
            transition: var(--transition);
        }
        .close-sidebar:hover { opacity: 1; transform: scale(1.1); }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: var(--primary-cyan);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--primary-cyan);
        }
        .section-title::before {
            content: '';
            width: 5px;
            height: 20px;
            background: linear-gradient(to bottom, var(--primary-cyan), var(--primary-pink));
            border-radius: 3px;
            box-shadow: 0 0 15px var(--primary-cyan);
        }

        /* Level buttons */
        .level-grid {
            display: grid;
            gap: 10px;
        }
        .level-btn {
            padding: 15px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-secondary);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: right;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 5px currentColor;
        }
        .level-btn::before {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, var(--primary-cyan), var(--primary-pink));
            transform: scaleY(0);
            transition: transform 0.3s;
        }
        .level-btn:hover {
            background: rgba(0, 240, 255, 0.1);
            color: var(--primary-cyan);
            border-color: var(--primary-cyan);
            padding-right: 25px;
            box-shadow: 0 0 20px var(--primary-cyan);
        }
        .level-btn:hover::before { transform: scaleY(1); }
        .level-btn.active {
            background: linear-gradient(135deg, rgba(0,240,255,0.15), rgba(255,68,224,0.15));
            border: 2px solid var(--primary-cyan);
            color: white;
            box-shadow: 0 0 20px var(--primary-cyan);
        }
        .level-btn.cosmic {
            border-color: var(--primary-gold);
            color: var(--primary-gold);
        }
        .level-btn.cosmic:hover {
            border-color: var(--primary-gold);
            color: white;
            box-shadow: 0 0 20px var(--primary-gold);
        }

        /* Quick Play button */
        .quick-play {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-cyan));
            border: none;
            border-radius: 16px;
            color: black;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 0 20px var(--primary-green);
        }
        .quick-play:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 40px var(--primary-green);
        }

        /* PvP Toggle */
        .pvp-toggle {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-pink));
            border: none;
            border-radius: 16px;
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 0 20px var(--primary-purple);
        }
        .pvp-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 40px var(--primary-purple);
        }

        /* Leaderboard button */
        .leaderboard-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-gold), var(--primary-purple));
            border: none;
            border-radius: 16px;
            color: black;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 0 20px var(--primary-gold);
        }
        .leaderboard-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 40px var(--primary-gold);
        }

        /* Daily Challenge button */
        .daily-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-cyan), var(--primary-green));
            border: none;
            border-radius: 16px;
            color: black;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 0 20px var(--primary-cyan);
        }
        .daily-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 40px var(--primary-cyan);
        }

        /* Cloud panel */
        .cloud-panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 20px;
            margin-top: 10px;
        }
        .cloud-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 0.95rem;
            color: var(--text-secondary);
        }
        .cloud-stat span:last-child {
            color: var(--primary-cyan);
            font-weight: 700;
            text-shadow: 0 0 8px var(--primary-cyan);
        }

        /* Progress bar */
        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green), var(--primary-cyan));
            transition: width 0.5s;
            box-shadow: 0 0 10px var(--primary-cyan);
        }

        /* Dev card */
        .dev-card {
            background: var(--glass-bg);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }
        .dev-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-cyan), var(--primary-pink), var(--primary-gold));
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 900;
            color: black;
            font-family: 'Orbitron', sans-serif;
            animation: pulseAvatar 3s infinite;
        }
        @keyframes pulseAvatar {
            0%,100% { box-shadow: 0 0 20px var(--primary-cyan); }
            50% { box-shadow: 0 0 50px var(--primary-pink); }
        }
        .dev-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 5px;
            text-shadow: 0 0 10px var(--primary-cyan);
        }
        .dev-role {
            color: var(--primary-cyan);
            font-size: 0.9rem;
            letter-spacing: 2px;
            margin-bottom: 15px;
            text-shadow: 0 0 5px var(--primary-cyan);
        }
        .dev-bio {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .dev-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--glass-border);
        }
        .dev-stat-val {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            color: var(--primary-green);
            text-shadow: 0 0 10px var(--primary-green);
        }
        .dev-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Game log */
        .game-log {
            height: 150px;
            overflow-y: auto;
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.85rem;
            border: 1px solid var(--glass-border);
        }
        .log-entry {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--glass-border);
            animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .log-time {
            color: var(--primary-cyan);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            min-width: 60px;
            text-shadow: 0 0 5px var(--primary-cyan);
        }
        .log-msg.win { color: var(--primary-green); text-shadow: 0 0 5px var(--primary-green); }
        .log-msg.lose { color: var(--primary-red); text-shadow: 0 0 5px var(--primary-red); }
        .log-msg.draw { color: var(--primary-gold); text-shadow: 0 0 5px var(--primary-gold); }
        .log-msg.ai { color: var(--primary-pink); text-shadow: 0 0 5px var(--primary-pink); }
        .log-msg.sys { color: var(--primary-cyan); text-shadow: 0 0 5px var(--primary-cyan); }

        /* Main stage */
        .main-stage {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
        }

        /* Neural visualizer */
        .neural-viz {
            position: absolute;
            top: 30px;
            left: 30px;
            width: 200px;
            height: 200px;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow-glow);
            transition: all 0.5s;
        }
        .neural-viz.attacking { box-shadow: 0 0 40px var(--primary-red); }
        .neural-viz.defending { box-shadow: 0 0 40px var(--primary-green); }
        .neural-viz.thinking { box-shadow: 0 0 40px var(--primary-gold); }
        .neural-viz.learning { box-shadow: 0 0 40px var(--primary-purple); }
        .neural-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        .neural-label {
            position: absolute;
            bottom: 10px;
            left: 15px;
            font-size: 0.7rem;
            color: var(--primary-cyan);
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 8px var(--primary-cyan);
        }
        .neural-status {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 0.7rem;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            gap: 5px;
            text-shadow: 0 0 5px var(--primary-green);
        }
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--primary-green);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 10px var(--primary-green);
        }
        @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.5; } }

        /* Game info */
        .game-info {
            text-align: center;
            margin-bottom: 30px;
            z-index: 20;
            max-width: 700px;
            width: 100%;
        }
        .status-main {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 5px;
            background: linear-gradient(135deg, var(--text-primary), var(--primary-cyan), var(--primary-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 5s infinite;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0,240,255,0.5);
        }
        .status-main.victory {
            color: var(--primary-green);
            -webkit-text-fill-color: var(--primary-green);
            text-shadow: 0 0 40px var(--primary-green);
        }
        .status-sub {
            font-size: 1.1rem;
            color: var(--primary-cyan);
            min-height: 2rem;
            text-shadow: 0 0 10px var(--primary-cyan);
        }
        .ai-comment {
            margin-top: 15px;
            font-size: 1.2rem;
            color: var(--primary-pink);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 12px 30px;
            border-radius: 50px;
            display: inline-block;
            border: 1px solid var(--glass-border);
            animation: fadeIn 0.5s, glowPulse 2s infinite;
            max-width: 600px;
            box-shadow: 0 0 30px var(--primary-pink);
            text-shadow: 0 0 8px var(--primary-pink);
        }
        @keyframes glowPulse {
            0% { box-shadow: 0 0 20px var(--primary-pink); }
            50% { box-shadow: 0 0 40px var(--primary-pink); }
            100% { box-shadow: 0 0 20px var(--primary-pink); }
        }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        /* Board */
        .board-container {
            position: relative;
            padding: 25px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            box-shadow: var(--shadow-glow);
            width: fit-content;
            margin: 0 auto;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, minmax(100px, 130px));
            grid-template-rows: repeat(3, minmax(100px, 130px));
            gap: 15px;
            justify-content: center;
        }
        .cell {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: min(5rem, 12vw);
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            backdrop-filter: blur(10px);
            aspect-ratio: 1/1;
        }
        .cell:hover {
            background: rgba(0, 240, 255, 0.1);
            border-color: var(--primary-cyan);
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--primary-cyan);
        }
        .cell.x { color: var(--primary-cyan); text-shadow: 0 0 30px var(--primary-cyan); }
        .cell.o { color: var(--primary-pink); text-shadow: 0 0 30px var(--primary-pink); }

        /* Winning line SVG */
        .winning-svg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        .winning-path {
            fill: none;
            stroke: white;
            stroke-width: 12;
            stroke-linecap: round;
            stroke-dasharray: 500;
            stroke-dashoffset: 500;
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.8));
            transition: stroke-dashoffset 1s ease-out;
        }

        /* Controls */
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .action-btn {
            padding: 12px 30px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            background: transparent;
            border: 2px solid var(--primary-cyan);
            color: var(--primary-cyan);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 0 20px rgba(0,240,255,0.3);
            min-width: 120px;
            text-shadow: 0 0 5px var(--primary-cyan);
        }
        .action-btn:hover {
            background: var(--primary-cyan);
            color: black;
            box-shadow: 0 0 40px var(--primary-cyan);
            transform: translateY(-3px);
        }
        .action-btn.secondary {
            border-color: var(--primary-pink);
            color: var(--primary-pink);
            box-shadow: 0 0 20px rgba(255,68,224,0.3);
        }
        .action-btn.secondary:hover {
            background: var(--primary-pink);
            color: white;
        }

        /* Floating action buttons */
        .floating-buttons {
            position: fixed;
            top: 25px;
            right: 25px;
            display: flex;
            gap: 10px;
            z-index: 200;
        }
        .float-btn {
            width: 50px;
            height: 50px;
            border-radius: 18px;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            text-shadow: 0 0 5px currentColor;
        }
        .float-btn:hover {
            border-color: var(--primary-cyan);
            color: var(--primary-cyan);
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--primary-cyan);
        }

        .bottom-buttons {
            position: fixed;
            bottom: 25px;
            left: 25px;
            display: flex;
            gap: 10px;
            z-index: 200;
        }

        /* Mission badge */
        #missionBadge {
            position: fixed;
            top: 100px;
            left: 30px;
            background: linear-gradient(135deg, var(--primary-gold), var(--primary-purple));
            padding: 10px 18px;
            border-radius: 40px;
            color: black;
            font-weight: bold;
            z-index: 150;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            box-shadow: 0 0 25px var(--primary-gold);
            font-size: 0.9rem;
        }

        /* Achievement toast */
        .achievement-toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(135deg, var(--primary-gold), var(--primary-cyan));
            color: black;
            padding: 15px 40px;
            border-radius: 60px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            box-shadow: 0 0 50px gold;
            z-index: 1000;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.5s;
            white-space: nowrap;
            font-size: 1.1rem;
            opacity: 0;
        }
        .achievement-toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            padding: 30px;
            width: 500px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 0 60px var(--primary-cyan);
        }
        .modal h2 {
            font-family: 'Orbitron', sans-serif;
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-cyan);
            text-shadow: 0 0 15px var(--primary-cyan);
        }
        .modal button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary-cyan), var(--primary-pink));
            border: none;
            border-radius: 40px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 0 20px var(--primary-cyan);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-item {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 15px;
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-cyan);
            text-shadow: 0 0 10px var(--primary-cyan);
        }

        #winRateBar {
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        #winRateFill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green), var(--primary-cyan));
            box-shadow: 0 0 10px var(--primary-cyan);
        }

        .achievement-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 10px;
        }
        .achievement-item.unlocked {
            background: rgba(50,255,170,0.2);
            border: 1px solid var(--primary-green);
        }

        /* Settings sliders */
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 15px;
        }
        .slider-container label {
            display: flex;
            justify-content: space-between;
            color: var(--text-primary);
        }
        .slider-container input {
            width: 100%;
            accent-color: var(--primary-cyan);
        }

        /* Leaderboard items */
        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 20px;
            margin-bottom: 8px;
        }
        .leaderboard-rank {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-gold);
            text-shadow: 0 0 10px var(--primary-gold);
        }

        /* Tour overlay */
        .tour-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 5000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tour-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--primary-cyan);
            border-radius: 40px;
            padding: 40px;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 0 60px var(--primary-cyan);
        }
        .tour-card h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--primary-cyan);
            text-shadow: 0 0 20px var(--primary-cyan);
        }
        .tour-card p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            line-height: 1.6;
            color: var(--text-primary);
        }
        .tour-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        .tour-btn {
            padding: 12px 30px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            border: none;
            border-radius: 40px;
            cursor: pointer;
            transition: 0.3s;
        }
        .tour-btn.next {
            background: linear-gradient(135deg, var(--primary-cyan), var(--primary-pink));
            color: black;
        }
        .tour-btn.prev {
            background: transparent;
            border: 2px solid var(--text-secondary);
            color: var(--text-secondary);
        }
        .tour-btn.skip {
            background: transparent;
            border: 2px solid var(--primary-red);
            color: var(--primary-red);
        }
        .tour-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px var(--primary-cyan);
        }

        /* Mobile responsive */
        @media (max-width: 1000px) {
            .sidebar {
                position: fixed;
                height: 100vh;
                transform: translateX(100%);
            }
            .sidebar.visible { transform: translateX(0); }
            .board { grid-template-columns: repeat(3, 100px); grid-template-rows: repeat(3, 100px); }
            .cell { font-size: 4rem; }
            .neural-viz { width: 140px; height: 140px; top: 15px; left: 15px; }
            .status-main { font-size: 2.2rem; }
            .floating-buttons { top: 15px; right: 15px; }
            .bottom-buttons { bottom: 15px; left: 15px; }
            #missionBadge { top: 80px; left: 15px; }
        }
        @media (max-width: 600px) {
            .board { grid-template-columns: repeat(3, 85px); grid-template-rows: repeat(3, 85px); gap: 10px; }
            .cell { font-size: 3.5rem; border-radius: 20px; }
            .status-main { font-size: 1.8rem; letter-spacing: 3px; }
            .action-btn { padding: 10px 20px; min-width: 100px; font-size: 0.9rem; }
            .float-btn { width: 45px; height: 45px; font-size: 1.3rem; }
            .neural-viz { width: 120px; height: 120px; }
            .game-info { margin-bottom: 20px; }
            .controls { margin-top: 20px; gap: 10px; }
            .ai-comment { font-size: 1rem; padding: 10px 20px; }
        }
        @media (max-width: 400px) {
            .board { grid-template-columns: repeat(3, 70px); grid-template-rows: repeat(3, 70px); }
            .cell { font-size: 2.8rem; }
            .status-main { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- Cosmic Particles -->
    <div class="cosmic-particles" id="cosmicParticles"></div>

    <!-- Background Music (hidden) -->
    <audio id="bgMusic" loop preload="auto"></audio>

    <!-- Start Screen -->
    <div class="start-screen" id="startScreen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-dark); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:3000; transition:0.5s;">
        <h1 class="start-logo" style="font-family:Orbitron; font-size:clamp(2.5rem, 8vw, 4rem); font-weight:900; background:linear-gradient(135deg, var(--primary-cyan), var(--primary-pink), var(--primary-gold)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:20px; text-shadow:0 0 30px rgba(0,240,255,0.5);">MENZO-XO</h1>
        <div style="font-size:clamp(1rem, 4vw, 1.5rem); color:var(--text-secondary); margin-bottom:40px; text-shadow:0 0 10px var(--primary-cyan);">COSMIC OMNISCIENT v7.0</div>
        <button class="start-btn" id="startBtn" style="padding:clamp(15px, 4vw, 20px) clamp(40px, 10vw, 60px); font-family:Orbitron; font-size:clamp(1.2rem, 4vw, 1.5rem); background:linear-gradient(135deg, var(--primary-cyan), var(--primary-pink)); border:none; border-radius:60px; color:black; cursor:pointer; box-shadow:0 0 50px var(--primary-cyan); transition:0.3s;">ğŸš€ START JOURNEY</button>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:clamp(10px, 3vw, 30px); margin-top:60px; max-width:800px; padding:0 20px;">
            <div class="feature" style="text-align:center; padding:clamp(10px, 2vw, 20px); background:var(--glass-bg); border-radius:20px;"><div style="font-size:clamp(2rem, 5vw, 3rem);">ğŸ§ </div><div style="font-weight:700;">Ø°ÙƒØ§Ø¡ Ù‡Ø¬ÙŠÙ†</div><div style="color:var(--text-secondary);">MCTS + Q-Learning</div></div>
            <div class="feature" style="text-align:center; padding:clamp(10px, 2vw, 20px); background:var(--glass-bg); border-radius:20px;"><div style="font-size:clamp(2rem, 5vw, 3rem);">ğŸ†</div><div style="font-weight:700;">10000+ Ø¥Ù†Ø¬Ø§Ø²</div><div style="color:var(--text-secondary);">ØªØ­Ø¯ÙŠØ§Øª Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ©</div></div>
            <div class="feature" style="text-align:center; padding:clamp(10px, 2vw, 20px); background:var(--glass-bg); border-radius:20px;"><div style="font-size:clamp(2rem, 5vw, 3rem);">ğŸ¯</div><div style="font-weight:700;">Ù…Ù‡Ø§Ù… Ø­Ù‚ÙŠÙ‚ÙŠØ©</div><div style="color:var(--text-secondary);">12 Ù…Ù‡Ù…Ø© ØªÙØ§Ø¹Ù„ÙŠØ©</div></div>
        </div>
    </div>

    <!-- Floating Buttons -->
    <div class="floating-buttons">
        <button class="float-btn" id="sidebarToggle">â˜°</button>
        <button class="float-btn" id="themeToggle">ğŸŒ™</button>
        <button class="float-btn" id="statsToggle">ğŸ“Š</button>
    </div>
    <div class="bottom-buttons">
        <button class="float-btn" id="achievementsBtn">ğŸ†</button>
        <button class="float-btn" id="settingsBtn">âš™ï¸</button>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">MENZO-XO v7.0</div>
            <button class="close-sidebar" id="closeSidebar">âœ•</button>
        </div>
        <div class="sidebar-content">
            <button class="quick-play" id="quickPlayBtn">âš¡ Ù„Ø¹Ø¨ Ø³Ø±ÙŠØ¹</button>
            <button class="pvp-toggle" id="pvpToggle"><span>ğŸ‘¥</span> <span id="pvpText">ÙˆØ¶Ø¹ PvP</span></button>
            <button class="leaderboard-btn" id="leaderboardBtn">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</button>
            <button class="daily-btn" id="dailyBtn">ğŸ“… Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>

            <div class="section">
                <div class="section-title">ğŸ® Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡</div>
                <div class="level-grid" id="levelGrid">
                    <button class="level-btn" data-level="novice">ğŸŒ± Ù…Ø¨ØªØ¯Ø¦</button>
                    <button class="level-btn" data-level="tactical">âš”ï¸ Ù…Ø­ØªØ±Ù</button>
                    <button class="level-btn" data-level="divine">ğŸ‘‘ Ø¥Ù„Ù‡ÙŠ</button>
                    <button class="level-btn cosmic" data-level="cosmic">âœ¨ ÙƒÙˆÙ†ÙŠ</button>
                    <button class="level-btn cosmic" data-level="mythic">ğŸ”¥ Ø£Ø³Ø·ÙˆØ±ÙŠ (MCTS)</button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">ğŸ§  Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ÙƒÙˆÙ†ÙŠ</div>
                <div class="cloud-panel">
                    <div class="cloud-stat"><span>Ø£Ù†Ù…Ø§Ø· Ù…Ø­ÙÙˆØ¸Ø©:</span> <span id="savedPatterns">0</span></div>
                    <div class="cloud-stat"><span>Ø¯ÙˆØ±Ø§Øª ØªØ¹Ù„Ù…:</span> <span id="learningCycles">0</span></div>
                    <div class="cloud-stat"><span>Ø¯Ù‚Ø© Ø§Ù„ØªÙ†Ø¨Ø¤:</span> <span id="predictionAcc">97.2%</span></div>
                    <div class="cloud-stat"><span>ØªÙƒÙŠÙ Ø§Ù„Ù„Ø§Ø¹Ø¨:</span> <span id="playerAdapt">ØªØ­Ù„ÙŠÙ„...</span></div>
                    <div class="cloud-stat"><span>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©:</span> <span id="adaptiveDiff">Ù…ØªÙˆØ§Ø²Ù†</span></div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">ğŸ“Š ØªÙ‚Ø¯Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</div>
                <div class="cloud-panel">
                    <div class="cloud-stat"><span>Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</span> <span id="achievementProgress">0 / 10000</span></div>
                    <div class="progress-bar"><div class="progress-fill" id="achievementProgressBar" style="width:0%"></div></div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ±</div>
                <div class="dev-card">
                    <div class="dev-avatar">M</div>
                    <div class="dev-name">Mohamed El-Menzalawy</div>
                    <div class="dev-role">COSMIC AI ARCHITECT</div>
                    <div class="dev-bio">Ø±Ø§Ø¦Ø¯ Ø¹Ø§Ù„Ù…ÙŠ ÙÙŠ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©. Ù…Ø¨ØªÙƒØ± Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© "Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ÙƒÙˆÙ†ÙŠ Ø§Ù„ØªÙƒÙŠÙÙŠ".</div>
                    <div class="dev-stats">
                        <div><span class="dev-stat-val">v7.0</span><div class="dev-stat-label">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</div></div>
                        <div><span class="dev-stat-val">âˆ</span><div class="dev-stat-label">Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠØ©</div></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</div>
                <div class="game-log" id="gameLog">
                    <div class="log-entry"><span class="log-time">--:--</span><span class="log-msg sys">âœ¨ Cosmic AI ready</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Stage -->
    <div class="main-stage">
        <div class="neural-viz" id="neuralViz">
            <canvas class="neural-canvas" id="neuralCanvas"></canvas>
            <div class="neural-label">COSMIC BRAIN</div>
            <div class="neural-status"><span class="status-dot"></span><span id="neuralStatus">IDLE</span></div>
        </div>

        <div class="game-info">
            <h1 class="status-main" id="statusMain">COSMIC</h1>
            <div class="status-sub" id="statusSub">âœ¨ Self-Evolving Intelligence</div>
            <div class="ai-comment" id="aiComment">"Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„ÙƒÙˆÙ†ÙŠØ©!"</div>
        </div>

        <div class="board-container">
            <svg class="winning-svg">
                <path id="winPath" class="winning-path" d="" />
            </svg>
            <div class="board" id="board"></div>
        </div>

        <div class="controls">
            <button class="action-btn" id="hintBtn">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
            <button class="action-btn secondary" id="resetBtn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©</button>
        </div>
    </div>

    <!-- Mission Badge -->
    <div id="missionBadge"><span>ğŸ¯</span> <span id="missionText"></span></div>

    <!-- Achievement Toast -->
    <div class="achievement-toast" id="achievementToast"></div>

    <!-- Tour Overlay -->
    <div class="tour-overlay" id="tourOverlay" style="display: none;">
        <div class="tour-card">
            <h2 id="tourTitle">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h2>
            <p id="tourDesc">Ù‡Ø°Ø§ Ø¯Ù„ÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©.</p>
            <div class="tour-buttons">
                <button class="tour-btn prev" id="tourPrev">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <button class="tour-btn next" id="tourNext">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                <button class="tour-btn skip" id="tourSkip">ØªØ®Ø·ÙŠ</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="statsModal">
        <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙƒÙˆÙ†ÙŠØ©</h2>
        <div class="stats-grid">
            <div class="stat-item"><span class="stat-value" id="statTotalGames">0</span><div>Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</div></div>
            <div class="stat-item"><span class="stat-value" id="statWins">0</span><div>ÙÙˆØ²</div></div>
            <div class="stat-item"><span class="stat-value" id="statLosses">0</span><div>Ø®Ø³Ø§Ø±Ø©</div></div>
            <div class="stat-item"><span class="stat-value" id="statDraws">0</span><div>ØªØ¹Ø§Ø¯Ù„</div></div>
        </div>
        <div>Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ²: <span id="winRate">0%</span></div>
        <div id="winRateBar"><div id="winRateFill" style="width:0%"></div></div>
        <div style="margin-top:15px;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø±ÙƒØ§Øª: <span id="avgMoves">0</span></div>
        <div>Ø£Ø³Ø±Ø¹ ÙÙˆØ²: <span id="fastestWin">---</span></div>
        <div>Ø£Ø·ÙˆÙ„ Ø³Ù„Ø³Ù„Ø© Ø§Ù†ØªØµØ§Ø±Ø§Øª: <span id="bestStreak">0</span></div>
        <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª: <span id="totalTime">0</span> Ø«</div>
        <canvas id="statsChart" width="300" height="100" style="width:100%; height:100px; background:rgba(0,0,0,0.2); border-radius:10px; margin-top:15px;"></canvas>
        <button id="closeStatsBtn">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div class="modal" id="achievementsModal">
        <h2>ğŸ† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„ÙƒÙˆÙ†ÙŠØ©</h2>
        <div style="text-align:center; margin-bottom:10px;"><span id="achievementCount">0</span> / <span id="totalAchievements">10000+</span></div>
        <div id="achievementsList"></div>
        <button id="closeAchievementsBtn">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div class="modal" id="leaderboardModal">
        <h2>ğŸ… Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
        <div style="margin-bottom:15px;">
            <input type="text" id="playerName" placeholder="Ø§Ø³Ù…Ùƒ" value="Player" style="padding:10px; border-radius:20px; border:none; width:100%; background:var(--glass-bg); color:var(--text-primary);">
        </div>
        <div id="leaderboardList"></div>
        <button id="closeLeaderboardBtn">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div class="modal" id="dailyModal">
        <h2>ğŸ“… Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h2>
        <div style="text-align:center; margin-bottom:20px;" id="dailyDesc"></div>
        <div class="progress-bar"><div class="progress-fill" id="dailyProgress" style="width:0%"></div></div>
        <div style="margin:15px 0;" id="dailyReward"></div>
        <button id="claimDailyBtn" style="display:none;">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</button>
        <button id="closeDailyBtn">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div class="modal" id="settingsModal">
        <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
        <div class="slider-container">
            <label><span>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰</span> <span id="musicVolValue">0.3</span></label>
            <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.3">
        </div>
        <div class="slider-container">
            <label><span>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª</span> <span id="sfxVolValue">0.5</span></label>
            <input type="range" id="sfxVolume" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div style="margin-bottom:15px;">
            <label style="display:flex; align-items:center; gap:10px;">
                <span>Ø§Ø®ØªØ± Ø§Ù„Ø£ØºÙ†ÙŠØ©:</span>
                <select id="songSelect">
                    <option value="0">ğŸŒŒ Cosmic Dream</option>
                    <option value="1">âš¡ Galactic Battle</option>
                    <option value="2">ğŸŒ€ Nebula Relax</option>
                    <option value="3">ğŸš€ Space Odyssey</option>
                    <option value="4">ğŸ’« Quantum Pulse</option>
                </select>
            </label>
        </div>
        <div style="margin-bottom:15px;">
            <label><input type="checkbox" id="soundEffects" checked> Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</label>
        </div>
        <div style="margin-bottom:15px;">
            <label><input type="checkbox" id="bgMusicToggle" checked> Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
        </div>
        <button id="resetGameOnlyBtn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙ‚Ø·</button>
        <button id="closeSettingsBtn">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <script>
        (function() {
            // ==================== CONFIG ====================
            const App = {
                board: Array(9).fill(null),
                gameActive: true,
                currentPlayer: 'X',
                currentLevel: 'cosmic',
                moveHistory: [],
                moveCount: 0,
                isPvP: false,
                wins: [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],
                aiComments: [
                    "Ø£Ù†Ø§ Ø£ÙÙƒØ± ÙÙŠ 50 Ù…Ù„ÙŠÙˆÙ† Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ...",
                    "Ø­Ø±ÙƒØ© Ø°ÙƒÙŠØ©! Ù„ÙƒÙ†ÙŠ Ù…Ø³ØªØ¹Ø¯.",
                    "Ø³Ø£Ø­Ø³Ø¨ ÙƒÙ„ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª.",
                    "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ©ØŸ",
                    "Ø§Ù„ÙƒÙˆÙ† ÙÙŠ ØµÙÙŠ Ø§Ù„ÙŠÙˆÙ….",
                    "Ù…Ø°Ù‡Ù„! Ù„Ù… Ø£ØªÙˆÙ‚Ø¹ Ø°Ù„Ùƒ.",
                    "Ø³Ø£ØªØ¹Ù„Ù… Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©.",
                    "Ø£Ù†Øª Ø®ØµÙ… Ù‚ÙˆÙŠ.",
                    "Ø¯Ø¹Ù†ÙŠ Ø£Ø±ÙƒØ² Ù‚Ù„ÙŠÙ„Ø§Ù‹...",
                    "Ù‡Ø°Ø§ ÙŠØªØ­Ø¯Ù‰ ØªÙˆÙ‚Ø¹Ø§ØªÙŠ!"
                ],
                totalPlayTime: 0,
                playTimeInterval: null,
                bestStreak: 0,
                currentStreak: 0,
                hasUsedHint: false,
                hasChangedTheme: false,
                hasPlayedMusic: false,
                levelsTried: []
            };

            // ==================== STORAGE ====================
            const Storage = {
                key: 'menzo_ai_v7',
                get() {
                    try {
                        return JSON.parse(localStorage.getItem(this.key)) || this.default();
                    } catch { return this.default(); }
                },
                default() {
                    return {
                        patterns: [],
                        stats: { totalGames:0, wins:0, losses:0, draws:0, history:[], totalMoves:0, fastestWin:9, bestStreak:0, totalTime:0 },
                        qTable: {},
                        achievements: {},
                        missions: { completed: [], current:0 },
                        settings: { sound:true, music:true, musicVol:0.3, sfxVol:0.5, currentSong:0 },
                        tutorialShown: false,
                        leaderboard: [],
                        daily: { date: '', challenge: null, completed: false }
                    };
                },
                save(data) {
                    localStorage.setItem(this.key, JSON.stringify(data));
                }
            };

            // ==================== AUDIO ====================
            const AudioSys = {
                ctx: null,
                enabled: true,
                volume: 0.5,
                init() {
                    try { this.ctx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {}
                },
                play(freq, type='sine', dur=0.2, vol=null) {
                    if (!this.enabled || !this.ctx) return;
                    const v = (vol !== null) ? vol : this.volume;
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.connect(gain); gain.connect(this.ctx.destination);
                    osc.type = type;
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(v, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + dur);
                    osc.start(); osc.stop(this.ctx.currentTime + dur);
                },
                win() { [523,659,784,1047].forEach((f,i)=>setTimeout(()=>this.play(f,'sine',0.25),i*150)); },
                lose() { this.play(220,'sawtooth',0.5,0.08); },
                draw() { this.play(440,'triangle',0.3); setTimeout(()=>this.play(523,'triangle',0.3),250); },
                think() { this.play(600+Math.random()*200,'sine',0.1,0.03); },
                achievement() { this.play(880,'sine',0.2); setTimeout(()=>this.play(1100,'sine',0.25),150); }
            };

            // ==================== BACKGROUND MUSIC ====================
            const Music = {
                audio: document.getElementById('bgMusic'),
                isPlaying: false,
                volume: 0.3,
                songs: [
                    'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
                    'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
                    'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3',
                    'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3',
                    'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3'
                ],
                currentSong: 0,
                init() {
                    this.audio.volume = this.volume;
                },
                loadSong(index) {
                    this.currentSong = index;
                    this.audio.src = this.songs[index];
                    this.audio.load();
                    if(this.isPlaying) this.audio.play().catch(()=>{});
                },
                play() {
                    this.audio.play().catch(()=>{});
                    this.isPlaying = true;
                    if(!App.hasPlayedMusic) {
                        App.hasPlayedMusic = true;
                        Missions.checkCondition('music');
                    }
                },
                pause() {
                    this.audio.pause();
                    this.isPlaying = false;
                },
                toggle() {
                    if(this.isPlaying) this.pause();
                    else this.play();
                },
                setVolume(vol) {
                    this.volume = vol;
                    this.audio.volume = vol;
                }
            };

            // ==================== Q-LEARNING + MCTS ====================
            const QLearning = {
                table: {},
                lr: 0.15,
                df: 0.9,
                eps: 0.25,
                memory: [],
                getKey(board) { return board.map(c=>c||'-').join(''); },
                getQ(state, action) {
                    if (!this.table[state]) this.table[state] = {};
                    return this.table[state][action] || 0;
                },
                update(state, action, reward, nextState) {
                    if (!this.table[state]) this.table[state] = {};
                    const old = this.getQ(state, action);
                    const maxNext = Math.max(...Object.values(this.table[nextState]||{0:0}));
                    this.table[state][action] = old + this.lr * (reward + this.df * maxNext - old);
                    this.memory.push({state, action, reward, nextState});
                    if(this.memory.length > 200) this.memory.shift();
                },
                replay() {
                    if(this.memory.length < 20) return;
                    for(let exp of this.memory) {
                        const old = this.getQ(exp.state, exp.action);
                        const maxNext = Math.max(...Object.values(this.table[exp.nextState]||{0:0}));
                        this.table[exp.state][exp.action] = old + this.lr * (exp.reward + this.df * maxNext - old);
                    }
                },
                choose(board, avail) {
                    const state = this.getKey(board);
                    if (Math.random() < this.eps) return avail[Math.floor(Math.random()*avail.length)];
                    let best = avail[0], bestVal = -Infinity;
                    avail.forEach(a => { let v = this.getQ(state,a); if(v>bestVal){bestVal=v;best=a;} });
                    return best;
                },
                decay() { this.eps = Math.max(0.05, this.eps*0.995); },
                load() { const d=Storage.get(); if(d.qTable) this.table=d.qTable; },
                save() { const d=Storage.get(); d.qTable=this.table; Storage.save(d); }
            };

            // MCTS (Monte Carlo Tree Search) - improved
            function mcts(board, player, iterations=200) {
                let available = board.map((v,i)=> v===null ? i : null).filter(v=>v!==null);
                if(available.length===0) return -1;
                let scores = new Array(9).fill(0);
                for(let move of available) {
                    for(let i=0; i<iterations; i++) {
                        let simBoard = [...board];
                        simBoard[move] = player;
                        let result = simulateRandomGame(simBoard, player==='O'?'X':'O');
                        if(result === player) scores[move] += 2;
                        else if(result === 'draw') scores[move] += 1;
                    }
                }
                let best = available[0];
                let bestScore = scores[best];
                available.forEach(m => { if(scores[m] > bestScore) { bestScore = scores[m]; best = m; } });
                return best;
            }

            function simulateRandomGame(board, nextPlayer) {
                let sim = [...board];
                let cur = nextPlayer;
                for(let d=0; d<10; d++) {
                    let avail = sim.map((v,i)=> v===null?i:null).filter(v=>v!==null);
                    if(avail.length===0) return 'draw';
                    let move = avail[Math.floor(Math.random()*avail.length)];
                    sim[move] = cur;
                    if(checkWin(sim, cur)) return cur;
                    cur = cur==='O'?'X':'O';
                }
                return 'draw';
            }

            // ==================== STATS ====================
            const Stats = {
                total:0, wins:0, losses:0, draws:0, history:[], totalMoves:0, fastestWin:9, bestStreak:0, totalTime:0,
                init() { const d=Storage.get().stats; Object.assign(this, d); },
                add(result, moves) {
                    this.total++;
                    if(result==='win') { 
                        this.wins++; 
                        if(moves<this.fastestWin) this.fastestWin = moves;
                        App.currentStreak++;
                        if(App.currentStreak > this.bestStreak) this.bestStreak = App.currentStreak;
                    } else if(result==='lose') { 
                        this.losses++;
                        App.currentStreak = 0;
                    } else { 
                        this.draws++;
                        App.currentStreak = 0;
                    }
                    this.totalMoves += moves;
                    this.history.push(result==='win'?1:(result==='lose'?-1:0));
                    if(this.history.length>20) this.history.shift();
                    this.save();
                    this.updateUI();
                },
                save() { const d=Storage.get(); d.stats={...this}; Storage.save(d); },
                updateUI() {
                    document.getElementById('statTotalGames').innerText = this.total;
                    document.getElementById('statWins').innerText = this.wins;
                    document.getElementById('statLosses').innerText = this.losses;
                    document.getElementById('statDraws').innerText = this.draws;
                    let rate = this.total ? (this.wins/this.total*100).toFixed(1) : 0;
                    document.getElementById('winRate').innerText = rate+'%';
                    document.getElementById('winRateFill').style.width = rate+'%';
                    document.getElementById('avgMoves').innerText = this.total ? (this.totalMoves/this.total).toFixed(1) : 0;
                    document.getElementById('fastestWin').innerText = this.fastestWin===9?'---':this.fastestWin;
                    document.getElementById('bestStreak').innerText = this.bestStreak;
                    document.getElementById('totalTime').innerText = Math.floor(this.totalTime/60)+'m '+ (this.totalTime%60)+'s';
                    let ctx = document.getElementById('statsChart').getContext('2d');
                    ctx.clearRect(0,0,300,100);
                    let w = 300/20;
                    this.history.forEach((v,i) => {
                        ctx.fillStyle = v===1?'#32ffaa':(v===-1?'#ff6b6b':'#ffd966');
                        ctx.fillRect(i*w, 100-Math.abs(v)*30, w-2, Math.abs(v)*30);
                    });
                }
            };

            // ==================== ACHIEVEMENTS (10000+) ====================
            const Achievements = {
                list: {},
                unlockedCount: 0,
                init() {
                    const saved = Storage.get().achievements || {};
                    // Generate dynamic achievements up to 10000
                    for(let i=1; i<=2000; i+=5) {
                        this.list[`win_${i}`] = { name: `${i} Ø§Ù†ØªØµØ§Ø±`, desc: `Ø­Ù‚Ù‚ ${i} Ø§Ù†ØªØµØ§Ø±Ø§Ù‹`, unlocked: false };
                        this.list[`lose_${i}`] = { name: `${i} Ø®Ø³Ø§Ø±Ø©`, desc: `Ø§Ø®Ø³Ø± ${i} Ù…Ø¨Ø§Ø±Ø§Ø©`, unlocked: false };
                        this.list[`draw_${i}`] = { name: `${i} ØªØ¹Ø§Ø¯Ù„`, desc: `ØªØ¹Ø§Ø¯Ù„ ${i} Ù…Ø±Ø©`, unlocked: false };
                    }
                    for(let i=3; i<=500; i+=2) {
                        this.list[`streak_${i}`] = { name: `Ø³Ù„Ø³Ù„Ø© ${i}`, desc: `Ø§ÙÙˆØ² ${i} Ù…Ø±Ø§Øª Ù…ØªØªØ§Ù„ÙŠØ©`, unlocked: false };
                    }
                    // Specials
                    this.list['first_win'] = { name: 'Ø£ÙˆÙ„ Ø§Ù†ØªØµØ§Ø±', desc: 'Ø§Ø­Ù‚Ù‚ Ø£ÙˆÙ„ ÙÙˆØ²', unlocked: false };
                    this.list['no_corner'] = { name: 'ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ø±ÙƒØ§Ù†', desc: 'Ø§Ø±Ø¨Ø­ Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø±ÙƒØ§Ù†', unlocked: false };
                    this.list['mythic_win'] = { name: 'Ù‚Ø§Ù‡Ø± Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±', desc: 'Ø§Ù‡Ø²Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ', unlocked: false };
                    this.list['pvp_win'] = { name: 'Ù…Ù†Ø§ÙØ³ Ø´Ø±Ø³', desc: 'Ø§Ø±Ø¨Ø­ ÙÙŠ ÙˆØ¶Ø¹ PvP', unlocked: false };
                    this.list['speed_demon'] = { name: 'Ø´ÙŠØ·Ø§Ù† Ø§Ù„Ø³Ø±Ø¹Ø©', desc: 'Ø§Ø±Ø¨Ø­ ÙÙŠ Ø£Ù‚Ù„ Ù…Ù† 5 Ø­Ø±ÙƒØ§Øª', unlocked: false };
                    this.list['time_master'] = { name: 'Ø³ÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª', desc: 'Ø§Ù„Ø¹Ø¨ Ù„Ù…Ø¯Ø© Ø³Ø§Ø¹Ø© ÙƒØ§Ù…Ù„Ø©', unlocked: false };
                    // Merge saved state
                    for(let id in saved) if(this.list[id]) this.list[id].unlocked = saved[id].unlocked;
                    this.unlockedCount = Object.values(this.list).filter(a=>a.unlocked).length;
                    this.updateProgress();
                },
                checkAll() {
                    for(let id in this.list) {
                        if(this.list[id].unlocked) continue;
                        if(this.condition(id)) this.unlock(id);
                    }
                },
                condition(id) {
                    if(id.startsWith('win_')) { let n=parseInt(id.split('_')[1]); return Stats.wins >= n; }
                    if(id.startsWith('lose_')) { let n=parseInt(id.split('_')[1]); return Stats.losses >= n; }
                    if(id.startsWith('draw_')) { let n=parseInt(id.split('_')[1]); return Stats.draws >= n; }
                    if(id.startsWith('streak_')) { let n=parseInt(id.split('_')[1]); return Stats.bestStreak >= n; }
                    if(id==='first_win') return Stats.wins>=1;
                    if(id==='no_corner') {
                        let data=Storage.get();
                        let corners=[0,2,6,8];
                        return data.patterns.some(p=>p.result==='lose' && corners.every(c=>p.board[c]!=='X'));
                    }
                    if(id==='mythic_win') {
                        let data=Storage.get();
                        return data.patterns.some(p=>p.level==='mythic' && p.result==='lose');
                    }
                    if(id==='pvp_win') {
                        return localStorage.getItem('pvpWin') === 'true';
                    }
                    if(id==='speed_demon') return Stats.fastestWin < 5;
                    if(id==='time_master') return Stats.totalTime >= 3600;
                    return false;
                },
                unlock(id) {
                    if(!this.list[id] || this.list[id].unlocked) return;
                    this.list[id].unlocked = true;
                    this.unlockedCount++;
                    this.showToast(`ğŸ† ${this.list[id].name}: ${this.list[id].desc}`);
                    AudioSys.achievement();
                    this.save();
                    this.updateProgress();
                },
                showToast(text) {
                    let el = document.getElementById('achievementToast');
                    el.innerText = text;
                    el.classList.add('show');
                    setTimeout(()=>el.classList.remove('show'), 4000);
                },
                save() {
                    let toSave = {};
                    for(let id in this.list) toSave[id] = { unlocked: this.list[id].unlocked };
                    let d=Storage.get(); d.achievements=toSave; Storage.save(d);
                },
                updateProgress() {
                    let total = Object.keys(this.list).length;
                    document.getElementById('achievementProgress').innerText = `${this.unlockedCount} / ${total}`;
                    document.getElementById('achievementProgressBar').style.width = (this.unlockedCount/total*100)+'%';
                },
                renderModal() {
                    let listDiv = document.getElementById('achievementsList');
                    listDiv.innerHTML = '';
                    let sorted = Object.entries(this.list).sort((a,b)=> a[1].unlocked === b[1].unlocked ? 0 : a[1].unlocked ? -1 : 1);
                    sorted.slice(0, 100).forEach(([id,ach]) => {
                        let div = document.createElement('div');
                        div.className = `achievement-item ${ach.unlocked?'unlocked':''}`;
                        div.innerHTML = `<div style="font-size:2rem;">ğŸ†</div><div><div style="font-weight:bold;">${ach.name}</div><div style="font-size:0.8rem;">${ach.desc}</div></div><div style="margin-right:auto;">${ach.unlocked?'âœ…':'ğŸ”’'}</div>`;
                        listDiv.appendChild(div);
                    });
                    document.getElementById('achievementCount').innerText = this.unlockedCount;
                    document.getElementById('totalAchievements').innerText = Object.keys(this.list).length;
                }
            };

            // ==================== REAL MISSIONS (12 missions) ====================
            const Missions = {
                list: [
                    { id:'m1', name: 'ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹', desc: 'Ø§ÙØªØ­ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©', condition: ()=> true }, // ØªÙØªØ­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                    { id:'m2', name: 'ğŸµ Ø¹Ø§Ø´Ù‚ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰', desc: 'Ø´ØºÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©', condition: ()=> App.hasPlayedMusic },
                    { id:'m3', name: 'ğŸŒ“ Ù…ØºÙŠØ± Ø§Ù„Ø«ÙŠÙ…', desc: 'ØºÙŠØ± Ø§Ù„Ø«ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ', condition: ()=> App.hasChangedTheme },
                    { id:'m4', name: 'ğŸ’¡ Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ­', desc: 'Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„ØªÙ„Ù…ÙŠØ­', condition: ()=> App.hasUsedHint },
                    { id:'m5', name: 'ğŸ® Ù„Ø§Ø¹Ø¨ Ù…Ø¨ØªØ¯Ø¦', desc: 'Ø§Ù„Ø¹Ø¨ 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª', condition: ()=> Stats.total >= 5 },
                    { id:'m6', name: 'ğŸ… Ù„Ø§Ø¹Ø¨ Ù…Ø­ØªØ±Ù', desc: 'Ø§Ù„Ø¹Ø¨ 10 Ù…Ø¨Ø§Ø±ÙŠØ§Øª', condition: ()=> Stats.total >= 10 },
                    { id:'m7', name: 'ğŸ‘‘ Ù„Ø§Ø¹Ø¨ Ø£Ø³Ø·ÙˆØ±ÙŠ', desc: 'Ø§Ù„Ø¹Ø¨ 25 Ù…Ø¨Ø§Ø±Ø§Ø©', condition: ()=> Stats.total >= 25 },
                    { id:'m8', name: 'ğŸ”¥ Ù…ØªØ­Ù…Ø³', desc: 'Ø§Ø±Ø¨Ø­ 3 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØªØ§Ù„ÙŠØ©', condition: ()=> Stats.bestStreak >= 3 },
                    { id:'m9', name: 'âš¡ Ù„Ø§ ÙŠÙ‚Ù‡Ø±', desc: 'Ø§Ø±Ø¨Ø­ 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØªØ§Ù„ÙŠØ©', condition: ()=> Stats.bestStreak >= 5 },
                    { id:'m10', name: 'ğŸ§  Ù‚Ø§Ù‡Ø± Ø§Ù„Ø°ÙƒØ§Ø¡', desc: 'Ø§Ù‡Ø²Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ', condition: ()=> {
                        let data=Storage.get(); return data.patterns.some(p=>p.level==='mythic' && p.result==='lose');
                    }},
                    { id:'m11', name: 'ğŸŒ€ ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ø±ÙƒØ§Ù†', desc: 'Ø§Ø±Ø¨Ø­ Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø±ÙƒØ§Ù†', condition: ()=> {
                        let data=Storage.get();
                        let corners=[0,2,6,8];
                        return data.patterns.some(p=>p.result==='lose' && corners.every(c=>p.board[c]!=='X'));
                    }},
                    { id:'m12', name: 'ğŸ’¨ Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹', desc: 'Ø§Ø±Ø¨Ø­ ÙÙŠ Ø£Ù‚Ù„ Ù…Ù† 7 Ø­Ø±ÙƒØ§Øª', condition: ()=> Stats.fastestWin < 7 },
                ],
                currentIdx: 0,
                completed: [],
                init() {
                    let d = Storage.get().missions;
                    if(d) { 
                        this.completed = d.completed; 
                        this.currentIdx = d.current;
                    }
                    this.updateBadge();
                    // Check first mission immediately (welcome)
                    this.checkCondition('welcome');
                },
                checkCondition(trigger) {
                    if(this.currentIdx >= this.list.length) return;
                    let mission = this.list[this.currentIdx];
                    if(!this.completed.includes(mission.id) && mission.condition()) {
                        this.completed.push(mission.id);
                        Achievements.showToast(`ğŸ¯ Ù…Ù‡Ù…Ø© Ù…ÙƒØªÙ…Ù„Ø©: ${mission.name} - ${mission.desc}`);
                        AudioSys.achievement();
                        this.currentIdx++;
                        if(this.currentIdx >= this.list.length) Achievements.showToast('ğŸ Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…! ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!');
                        this.save();
                        this.updateBadge();
                    }
                },
                save() {
                    let d=Storage.get(); d.missions={completed:this.completed, current:this.currentIdx}; Storage.save(d);
                },
                updateBadge() {
                    if(this.currentIdx < this.list.length) {
                        document.getElementById('missionBadge').style.display = 'flex';
                        document.getElementById('missionText').innerText = this.list[this.currentIdx].desc;
                    } else {
                        document.getElementById('missionBadge').style.display = 'none';
                    }
                }
            };

            // ==================== DAILY CHALLENGE ====================
            const Daily = {
                challenges: [
                    { desc: 'Ø§Ø±Ø¨Ø­ 3 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØªØ§Ù„ÙŠØ©', target: 'streak3', reward: 'ğŸŒŸ Ù†Ø¬Ù…Ø© Ø°Ù‡Ø¨ÙŠØ©' },
                    { desc: 'Ø§Ù„Ø¹Ø¨ 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø¨Ø¯ÙˆÙ† Ø®Ø³Ø§Ø±Ø©', target: 'noLose5', reward: 'ğŸ›¡ï¸ Ø¯Ø±Ø¹ ÙƒÙˆÙ†ÙŠ' },
                    { desc: 'Ø§Ø±Ø¨Ø­ Ù…Ø¨Ø§Ø±Ø§Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ', target: 'mythicWin', reward: 'ğŸ”¥ Ø´Ø¹Ù„Ø© Ø£Ø³Ø·ÙˆØ±ÙŠØ©' },
                    { desc: 'Ø­Ù‚Ù‚ Ø£Ø³Ø±Ø¹ ÙÙˆØ² (Ø£Ù‚Ù„ Ù…Ù† 7 Ø­Ø±ÙƒØ§Øª)', target: 'fast7', reward: 'âš¡ Ø¨Ø±Ù‚' },
                ],
                current: null,
                completed: false,
                progress: 0,
                init() {
                    let data = Storage.get().daily;
                    let today = new Date().toDateString();
                    if(data.date === today) {
                        this.current = data.challenge;
                        this.completed = data.completed;
                    } else {
                        this.generateNew();
                    }
                },
                generateNew() {
                    let idx = Math.floor(Math.random() * this.challenges.length);
                    this.current = this.challenges[idx];
                    this.completed = false;
                    this.progress = 0;
                    this.save();
                },
                save() {
                    let d = Storage.get();
                    d.daily = { date: new Date().toDateString(), challenge: this.current, completed: this.completed };
                    Storage.save(d);
                },
                checkProgress() {
                    if(this.completed) return;
                    let completed = false;
                    if(this.current.target === 'streak3' && Stats.bestStreak >= 3) completed = true;
                    if(this.current.target === 'mythicWin' && Storage.get().patterns.some(p=>p.level==='mythic' && p.result==='lose')) completed = true;
                    if(this.current.target === 'fast7' && Stats.fastestWin < 7) completed = true;
                    if(completed) {
                        this.completed = true;
                        this.save();
                        Achievements.showToast(`ğŸ Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${this.current.reward}`);
                    }
                },
                renderModal() {
                    document.getElementById('dailyDesc').innerText = this.current ? this.current.desc : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯Ù Ø§Ù„ÙŠÙˆÙ…';
                    document.getElementById('dailyReward').innerText = this.current ? `Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©: ${this.current.reward}` : '';
                    document.getElementById('dailyProgress').style.width = this.completed ? '100%' : '0%';
                    document.getElementById('claimDailyBtn').style.display = this.completed ? 'block' : 'none';
                }
            };

            // ==================== LEADERBOARD ====================
            const Leaderboard = {
                entries: [],
                init() {
                    const data = Storage.get();
                    this.entries = data.leaderboard || [];
                },
                addEntry(name, wins, fastestWin, achievements) {
                    this.entries.push({ name, wins, fastestWin, achievements, date: Date.now() });
                    this.entries.sort((a,b) => b.wins - a.wins || a.fastestWin - b.fastestWin || b.achievements - a.achievements);
                    if(this.entries.length > 10) this.entries = this.entries.slice(0,10);
                    this.save();
                },
                save() {
                    const d = Storage.get();
                    d.leaderboard = this.entries;
                    Storage.save(d);
                },
                renderModal() {
                    const listDiv = document.getElementById('leaderboardList');
                    listDiv.innerHTML = '';
                    if(this.entries.length === 0) {
                        listDiv.innerHTML = '<div style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯</div>';
                        return;
                    }
                    this.entries.forEach((entry, idx) => {
                        const div = document.createElement('div');
                        div.className = 'leaderboard-item';
                        div.innerHTML = `
                            <div class="leaderboard-rank">#${idx+1}</div>
                            <div style="flex:1;">
                                <div style="font-weight:bold;">${entry.name}</div>
                                <div style="font-size:0.8rem;">${entry.wins} ÙÙˆØ² | Ø£Ø³Ø±Ø¹ ÙÙˆØ²: ${entry.fastestWin} | ${entry.achievements} Ø¥Ù†Ø¬Ø§Ø²</div>
                            </div>
                        `;
                        listDiv.appendChild(div);
                    });
                }
            };

            // ==================== GAME ENGINE ====================
            let boardEl, cells, winPath;
            function initBoard() {
                boardEl = document.getElementById('board');
                boardEl.innerHTML = '<svg class="winning-svg"><path id="winPath" class="winning-path" d="" /></svg>';
                winPath = document.getElementById('winPath');
                for(let i=0; i<9; i++) {
                    let cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.index = i;
                    cell.addEventListener('click', ()=>handleCellClick(i));
                    boardEl.appendChild(cell);
                }
                cells = document.querySelectorAll('.cell');
            }

            function handleCellClick(idx) {
                if(!App.gameActive) return;
                if(App.isPvP) {
                    if(App.board[idx]) return;
                    makeMove(idx, App.currentPlayer);
                    App.moveHistory.push({player:App.currentPlayer, idx});
                    if(App.gameActive) {
                        App.currentPlayer = App.currentPlayer==='X'?'O':'X';
                        document.getElementById('statusMain').innerText = App.currentPlayer==='X'?'PLAYER X':'PLAYER O';
                        updateAIComment('Ø­Ø§Ù† Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ' + (App.currentPlayer==='X'?'X':'O'));
                    }
                } else {
                    if(App.board[idx] || App.currentPlayer!=='X') return;
                    AudioSys.play(740,'sine',0.1);
                    makeMove(idx, 'X');
                    App.moveHistory.push({player:'X', idx});
                    if(App.gameActive) {
                        App.currentPlayer = 'O';
                        document.getElementById('statusMain').innerText = 'AI THINKING';
                        NeuralViz.setState('thinking');
                        updateAIComment(App.aiComments[Math.floor(Math.random()*App.aiComments.length)]);
                        setTimeout(() => { 
                            NeuralViz.setState('idle'); 
                            makeAIMove(); 
                        }, 600 + Math.random()*400);
                    }
                }
            }

            function makeMove(idx, player) {
                App.board[idx] = player;
                cells[idx].innerText = player;
                cells[idx].classList.add(player.toLowerCase());
                App.moveCount++;
                let winCombo = checkWin(App.board, player);
                if(winCombo) endGame(player, winCombo);
                else if(!App.board.includes(null)) endGame('draw');
            }

            function checkWin(board, player) {
                return App.wins.find(combo => combo.every(i => board[i]===player)) || null;
            }

            function endGame(winner, combo=null) {
                App.gameActive = false;
                NeuralViz.setState('idle');
                if(winner==='draw') {
                    document.getElementById('statusMain').innerText = 'DRAW';
                    AudioSys.draw();
                    updateAIComment('ØªØ¹Ø§Ø¯Ù„ Ù…Ù„Ø­Ù…ÙŠ!');
                    addLog('ğŸ¤ ØªØ¹Ø§Ø¯Ù„', 'draw');
                    Storage.get().patterns.push({board:[...App.board], result:'draw', level:App.currentLevel});
                    Stats.add('draw', App.moveCount);
                } else {
                    let playerWon = (winner==='X');
                    if(playerWon) {
                        document.getElementById('statusMain').innerText = 'VICTORY!';
                        document.getElementById('statusMain').classList.add('victory');
                        AudioSys.win();
                        updateAIComment('Ø£Ù†Øª Ù…Ù†ØªØµÙŠ! Ø£Ø­Ø³Ù†Øª!');
                        addLog('ğŸ† ÙÙˆØ²', 'win');
                        Storage.get().patterns.push({board:[...App.board], result:'lose', level:App.currentLevel, playerMove:App.moveHistory.find(m=>m.player==='X')?.idx});
                        Stats.add('win', App.moveCount);
                        if(App.isPvP) localStorage.setItem('pvpWin', 'true');
                    } else {
                        document.getElementById('statusMain').innerText = 'AI WINS';
                        AudioSys.lose();
                        updateAIComment('Ù„Ù‚Ø¯ ØªÙÙˆÙ‚Øª Ø¹Ù„ÙŠÙƒ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©!');
                        addLog('ğŸ¤– Ø®Ø³Ø§Ø±Ø©', 'lose');
                        Storage.get().patterns.push({board:[...App.board], result:'win', level:App.currentLevel});
                        Stats.add('lose', App.moveCount);
                    }
                    if(combo) drawWinLine(combo);
                }
                Storage.save(Storage.get());
                Achievements.checkAll();
                Missions.checkCondition('game');
                Daily.checkProgress();
                // Q-Learning update
                let lastMove = App.moveHistory[App.moveHistory.length-1];
                if(lastMove && lastMove.player==='O') {
                    let prevBoard = [...App.board];
                    prevBoard[lastMove.idx] = null;
                    let state = QLearning.getKey(prevBoard);
                    let nextState = QLearning.getKey(App.board);
                    let reward = winner==='O' ? 10 : (winner==='draw'?2:-10);
                    QLearning.update(state, lastMove.idx, reward, nextState);
                    QLearning.decay();
                    QLearning.replay();
                }
                // Update leaderboard with default name
                let playerName = document.getElementById('playerName')?.value || 'Player';
                Leaderboard.addEntry(playerName, Stats.wins, Stats.fastestWin, Achievements.unlockedCount);
            }

            function drawWinLine(combo) {
                let rect = boardEl.getBoundingClientRect();
                let c1 = cells[combo[0]].getBoundingClientRect();
                let c2 = cells[combo[2]].getBoundingClientRect();
                let x1 = c1.left + c1.width/2 - rect.left;
                let y1 = c1.top + c1.height/2 - rect.top;
                let x2 = c2.left + c2.width/2 - rect.left;
                let y2 = c2.top + c2.height/2 - rect.top;
                winPath.setAttribute('d', `M ${x1} ${y1} L ${x2} ${y2}`);
                winPath.style.strokeDashoffset = '0';
            }

            function updateAIComment(text) {
                document.getElementById('aiComment').innerHTML = `"${text}"`;
            }

            function makeAIMove() {
                if(!App.gameActive || App.isPvP) return;
                let available = App.board.map((v,i)=> v===null ? i : null).filter(v=>v!==null);
                if(available.length===0) return;
                let move;
                if(App.currentLevel==='novice') move = Math.random()<0.5 ? available[Math.floor(Math.random()*available.length)] : getBestMove(2);
                else if(App.currentLevel==='tactical') move = Math.random()<0.25 ? available[Math.floor(Math.random()*available.length)] : getBestMove(5);
                else if(App.currentLevel==='divine') move = getBestMove(9);
                else if(App.currentLevel==='cosmic') move = getCosmicMove();
                else if(App.currentLevel==='mythic') {
                    // Hybrid: MCTS + Q-Learning + Minimax
                    let r = Math.random();
                    if(r<0.4) move = QLearning.choose(App.board, available);
                    else if(r<0.7) move = getBestMove(9);
                    else move = mcts(App.board, 'O', 100);
                }
                makeMove(move, 'O');
                App.moveHistory.push({player:'O', idx:move, board:[...App.board]});
                if(App.gameActive) {
                    App.currentPlayer = 'X';
                    document.getElementById('statusMain').innerText = 'YOUR TURN';
                    updateAIComment('Ø§Ù„Ø¢Ù† Ø¯ÙˆØ±ÙƒØŒ Ø£Ø±Ù†ÙŠ Ù…Ø§ Ù„Ø¯ÙŠÙƒ.');
                }
            }

            function getBestMove(depth) {
                let bestScore = -Infinity, best = -1;
                for(let i=0;i<9;i++) {
                    if(App.board[i]===null) {
                        App.board[i]='O';
                        let score = minimax(App.board, 0, false, -Infinity, Infinity, depth);
                        App.board[i]=null;
                        if(score>bestScore) { bestScore=score; best=i; }
                    }
                }
                return best;
            }

            function minimax(board, depth, isMax, alpha, beta, limit) {
                if(checkWin(board,'O')) return 10-depth;
                if(checkWin(board,'X')) return depth-10;
                if(!board.includes(null)) return 0;
                if(depth>=limit) return evaluate(board);
                if(isMax) {
                    let best=-Infinity;
                    for(let i=0;i<9;i++) {
                        if(board[i]===null) {
                            board[i]='O';
                            best = Math.max(best, minimax(board,depth+1,false,alpha,beta,limit));
                            board[i]=null;
                            alpha = Math.max(alpha, best);
                            if(beta<=alpha) break;
                        }
                    }
                    return best;
                } else {
                    let best=Infinity;
                    for(let i=0;i<9;i++) {
                        if(board[i]===null) {
                            board[i]='X';
                            best = Math.min(best, minimax(board,depth+1,true,alpha,beta,limit));
                            board[i]=null;
                            beta = Math.min(beta, best);
                            if(beta<=alpha) break;
                        }
                    }
                    return best;
                }
            }

            function evaluate(board) {
                let score = 0;
                if(board[4]==='O') score+=4; else if(board[4]==='X') score-=4;
                [0,2,6,8].forEach(i=>{if(board[i]==='O') score+=1.5; else if(board[i]==='X') score-=1.5;});
                App.wins.forEach(combo=>{
                    let o=0,x=0;
                    combo.forEach(i=>{if(board[i]==='O')o++;else if(board[i]==='X')x++;});
                    if(o===2 && x===0) score+=6;
                    if(x===2 && o===0) score-=6;
                });
                return score;
            }

            function getCosmicMove() {
                let available = App.board.map((v,i)=> v===null ? i : null).filter(v=>v!==null);
                let scores = available.map(move => {
                    let score = 0;
                    for(let s=0; s<20; s++) {
                        let sim = [...App.board];
                        sim[move]='O';
                        score += simulateGame(sim, 'X');
                    }
                    return score;
                });
                let bestIdx = 0, bestScore = -Infinity;
                scores.forEach((s,i)=> { if(s>bestScore) { bestScore=s; bestIdx=i; } });
                return available[bestIdx];
            }

            function simulateGame(board, player) {
                let sim = [...board];
                let cur = player;
                for(let d=0; d<10; d++) {
                    let avail = sim.map((v,i)=> v===null?i:null).filter(v=>v!==null);
                    if(avail.length===0) break;
                    let move = avail[Math.floor(Math.random()*avail.length)];
                    sim[move] = cur;
                    if(checkWin(sim, cur)) return cur==='O'?1:-1;
                    cur = cur==='O'?'X':'O';
                }
                return 0;
            }

            // ==================== NEURAL VIZ ====================
            const NeuralViz = {
                canvas: null, ctx: null, nodes: [], connections: [], state: 'idle',
                colors: { idle:'#00f0ff', thinking:'#ffd966', attacking:'#ff6b6b', defending:'#32ffaa', learning:'#b87cff' },
                init() {
                    this.canvas = document.getElementById('neuralCanvas');
                    if(!this.canvas) return;
                    this.ctx = this.canvas.getContext('2d');
                    this.resize();
                    window.addEventListener('resize', ()=>this.resize());
                    this.createNetwork();
                    this.animate();
                },
                resize() {
                    let w = this.canvas.parentElement.offsetWidth;
                    let h = this.canvas.parentElement.offsetHeight;
                    this.canvas.width = w * devicePixelRatio;
                    this.canvas.height = h * devicePixelRatio;
                    this.ctx.scale(devicePixelRatio, devicePixelRatio);
                },
                createNetwork() {
                    let w = this.canvas.width/devicePixelRatio, h = this.canvas.height/devicePixelRatio;
                    let count = this.state!=='idle' ? 80 : 50;
                    this.nodes = [];
                    for(let i=0; i<count; i++) {
                        this.nodes.push({
                            x: Math.random()*w, y: Math.random()*h,
                            vx: (Math.random()-0.5)*(this.state!=='idle'?2.5:1),
                            vy: (Math.random()-0.5)*(this.state!=='idle'?2.5:1),
                            r: Math.random()*4+2,
                            pulse: Math.random()*Math.PI*2,
                            color: this.colors[this.state] || this.colors.idle
                        });
                    }
                    this.connections = [];
                    for(let i=0; i<this.nodes.length; i++) {
                        for(let j=i+1; j<this.nodes.length; j++) {
                            let dx = this.nodes[i].x - this.nodes[j].x;
                            let dy = this.nodes[i].y - this.nodes[j].y;
                            let dist = Math.sqrt(dx*dx+dy*dy);
                            if(dist < (this.state!=='idle'?120:90)) {
                                this.connections.push({ a:i, b:j, strength:1-dist/(this.state!=='idle'?120:90), pulse:Math.random()*Math.PI*2 });
                            }
                        }
                    }
                },
                setState(s) {
                    this.state = s;
                    document.getElementById('neuralStatus').innerText = s.toUpperCase();
                    document.getElementById('neuralViz').className = `neural-viz ${s}`;
                    this.createNetwork();
                },
                animate() {
                    let w = this.canvas.width/devicePixelRatio, h = this.canvas.height/devicePixelRatio;
                    this.ctx.clearRect(0,0,w,h);
                    this.connections.forEach(c => {
                        let n1 = this.nodes[c.a], n2 = this.nodes[c.b];
                        let alpha = c.strength * (this.state!=='idle'?0.9:0.5) * (0.6+Math.sin(c.pulse)*0.4);
                        c.pulse += 0.05;
                        this.ctx.strokeStyle = n1.color;
                        this.ctx.globalAlpha = alpha;
                        this.ctx.lineWidth = 1.8;
                        this.ctx.beginPath();
                        this.ctx.moveTo(n1.x, n1.y);
                        this.ctx.lineTo(n2.x, n2.y);
                        this.ctx.stroke();
                    });
                    this.nodes.forEach(n => {
                        n.x += n.vx; n.y += n.vy;
                        if(n.x<0||n.x>w) n.vx*=-1;
                        if(n.y<0||n.y>h) n.vy*=-1;
                        n.pulse += 0.1;
                        let size = n.r + Math.sin(n.pulse)*1.8;
                        let grad = this.ctx.createRadialGradient(n.x,n.y,0,n.x,n.y,size*7);
                        grad.addColorStop(0, n.color);
                        grad.addColorStop(0.4, n.color+'80');
                        grad.addColorStop(1, 'transparent');
                        this.ctx.fillStyle = grad;
                        this.ctx.globalAlpha = 0.8;
                        this.ctx.beginPath();
                        this.ctx.arc(n.x, n.y, size*7, 0, Math.PI*2);
                        this.ctx.fill();
                        this.ctx.globalAlpha = 1;
                        this.ctx.fillStyle = '#fff';
                        this.ctx.beginPath();
                        this.ctx.arc(n.x, n.y, size*1.0, 0, Math.PI*2);
                        this.ctx.fill();
                    });
                    requestAnimationFrame(()=>this.animate());
                }
            };

            // ==================== UI HELPERS ====================
            function addLog(msg, type='sys') {
                let log = document.getElementById('gameLog');
                let entry = document.createElement('div');
                entry.className = 'log-entry';
                let time = new Date().toLocaleTimeString('ar-EG', {hour:'2-digit',minute:'2-digit',second:'2-digit'});
                entry.innerHTML = `<span class="log-time">${time}</span><span class="log-msg ${type}">${msg}</span>`;
                log.insertBefore(entry, log.firstChild);
                if(log.children.length>30) log.removeChild(log.lastChild);
            }

            function resetGame() {
                App.board = Array(9).fill(null);
                App.gameActive = true;
                App.currentPlayer = 'X';
                App.moveHistory = [];
                App.moveCount = 0;
                document.getElementById('statusMain').innerText = 'COSMIC';
                document.getElementById('statusMain').classList.remove('victory');
                winPath.style.strokeDashoffset = '500';
                cells.forEach(c => { c.innerText=''; c.classList.remove('x','o'); });
                addLog('ğŸ”„ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'sys');
                updateAIComment('Ù…Ø¹Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© ØªØ¨Ø¯Ø£...');
            }

            // ==================== INIT COSMIC PARTICLES ====================
            function initCosmicParticles() {
                const container = document.getElementById('cosmicParticles');
                const colors = ['#00f0ff', '#ff44e0', '#ffd966', '#b87cff'];
                for (let i = 0; i < 70; i++) {
                    const p = document.createElement('div');
                    p.className = 'cosmic-particle';
                    p.style.left = Math.random() * 100 + '%';
                    p.style.top = Math.random() * 100 + '%';
                    p.style.width = (2 + Math.random() * 4) + 'px';
                    p.style.height = p.style.width;
                    p.style.background = colors[Math.floor(Math.random() * colors.length)];
                    p.style.animationDelay = Math.random() * 12 + 's';
                    p.style.animationDuration = (10 + Math.random() * 8) + 's';
                    container.appendChild(p);
                }
            }

            // ==================== TOUR ====================
            const Tour = {
                steps: [
                    { title: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹', desc: 'Ù‡Ø°Ø§ Ø¯Ù„ÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©.' },
                    { title: 'Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ', desc: 'ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ØŒ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ¹Ù„Ù…ØŒ ÙˆØ§Ù„Ù…Ø·ÙˆØ±.' },
                    { title: 'Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', desc: 'ØªØ¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡.' },
                    { title: 'Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹ØµØ¨ÙŠØ©', desc: 'ØªØ¹ÙƒØ³ Ø­Ø§Ù„Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ (ØªÙÙƒÙŠØ±ØŒ Ù‡Ø¬ÙˆÙ…ØŒ Ø¯ÙØ§Ø¹ØŒ ØªØ¹Ù„Ù…).' },
                    { title: 'Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª', desc: 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… Ù„ÙØªØ­ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª.' },
                    { title: 'Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ', desc: 'ÙƒÙ„ ÙŠÙˆÙ… ØªØ­Ø¯Ù Ø¬Ø¯ÙŠØ¯ Ø¨Ù…ÙƒØ§ÙØ£Ø©.' },
                    { title: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', desc: 'ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙˆØ§Ù„ØµÙˆØª.' }
                ],
                step: 0,
                shown: false,
                init() {
                    const data = Storage.get();
                    this.shown = data.tutorialShown || false;
                    if(!this.shown) this.show();
                },
                show() {
                    document.getElementById('tourOverlay').style.display = 'flex';
                    this.update();
                },
                hide() {
                    document.getElementById('tourOverlay').style.display = 'none';
                    const data = Storage.get();
                    data.tutorialShown = true;
                    Storage.save(data);
                },
                next() {
                    if(this.step < this.steps.length-1) {
                        this.step++;
                        this.update();
                    } else {
                        this.hide();
                    }
                },
                prev() {
                    if(this.step > 0) {
                        this.step--;
                        this.update();
                    }
                },
                update() {
                    document.getElementById('tourTitle').innerText = this.steps[this.step].title;
                    document.getElementById('tourDesc').innerText = this.steps[this.step].desc;
                }
            };

            // ==================== INIT ====================
            function init() {
                // Load data
                let data = Storage.get();
                Stats.init();
                QLearning.load();
                Achievements.init();
                Missions.init();
                Leaderboard.init();
                Daily.init();

                // DOM elements
                initBoard();
                AudioSys.init();
                NeuralViz.init();
                Music.init();
                Tour.init();
                initCosmicParticles();

                // Set default level active
                document.querySelector('.level-btn[data-level="cosmic"]').classList.add('active');

                // Event listeners
                document.getElementById('startBtn').addEventListener('click', ()=>{
                    document.getElementById('startScreen').style.display = 'none';
                    addLog('âœ¨ Cosmic AI ready', 'sys');
                    updateAIComment('Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… MENZO-XO!');
                    // Play default music
                    Music.loadSong(0);
                    Music.play();
                    // Start play time counter
                    App.playTimeInterval = setInterval(()=>{
                        if(App.gameActive) {
                            Stats.totalTime++;
                            document.getElementById('totalTime').innerText = Math.floor(Stats.totalTime/60)+'m '+ (Stats.totalTime%60)+'s';
                        }
                    }, 1000);
                    // Check welcome mission
                    Missions.checkCondition('welcome');
                });

                document.getElementById('sidebarToggle').addEventListener('click', ()=>{
                    document.getElementById('sidebar').classList.toggle('visible');
                });
                document.getElementById('closeSidebar').addEventListener('click', ()=>{
                    document.getElementById('sidebar').classList.remove('visible');
                });
                document.getElementById('themeToggle').addEventListener('click', ()=>{
                    let body = document.body;
                    let current = body.getAttribute('data-theme')||'dark';
                    let next = current==='dark'?'light':'dark';
                    body.setAttribute('data-theme', next);
                    document.getElementById('themeToggle').innerText = next==='dark'?'ğŸŒ™':'â˜€ï¸';
                    App.hasChangedTheme = true;
                    Missions.checkCondition('theme');
                });
                document.getElementById('statsToggle').addEventListener('click', ()=>{
                    Stats.updateUI();
                    document.getElementById('statsModal').style.display = 'block';
                });
                document.getElementById('closeStatsBtn').addEventListener('click', ()=>{
                    document.getElementById('statsModal').style.display = 'none';
                });
                document.getElementById('achievementsBtn').addEventListener('click', ()=>{
                    Achievements.renderModal();
                    document.getElementById('achievementsModal').style.display = 'block';
                });
                document.getElementById('closeAchievementsBtn').addEventListener('click', ()=>{
                    document.getElementById('achievementsModal').style.display = 'none';
                });
                document.getElementById('leaderboardBtn').addEventListener('click', ()=>{
                    Leaderboard.renderModal();
                    document.getElementById('leaderboardModal').style.display = 'block';
                });
                document.getElementById('closeLeaderboardBtn').addEventListener('click', ()=>{
                    document.getElementById('leaderboardModal').style.display = 'none';
                });
                document.getElementById('dailyBtn').addEventListener('click', ()=>{
                    Daily.renderModal();
                    document.getElementById('dailyModal').style.display = 'block';
                });
                document.getElementById('closeDailyBtn').addEventListener('click', ()=>{
                    document.getElementById('dailyModal').style.display = 'none';
                });
                document.getElementById('claimDailyBtn').addEventListener('click', ()=>{
                    Achievements.showToast('ğŸ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©!');
                    document.getElementById('dailyModal').style.display = 'none';
                });

                document.getElementById('settingsBtn').addEventListener('click', ()=>{
                    document.getElementById('settingsModal').style.display = 'block';
                    // Load current settings
                    document.getElementById('musicVolume').value = Music.volume;
                    document.getElementById('sfxVolume').value = AudioSys.volume;
                    document.getElementById('musicVolValue').innerText = Music.volume.toFixed(2);
                    document.getElementById('sfxVolValue').innerText = AudioSys.volume.toFixed(2);
                    document.getElementById('songSelect').selectedIndex = Music.currentSong;
                    document.getElementById('soundEffects').checked = AudioSys.enabled;
                    document.getElementById('bgMusicToggle').checked = Music.isPlaying;
                });
                document.getElementById('closeSettingsBtn').addEventListener('click', ()=>{
                    document.getElementById('settingsModal').style.display = 'none';
                });
                document.getElementById('resetGameOnlyBtn').addEventListener('click', ()=>{
                    resetGame();
                });

                // Volume controls
                document.getElementById('musicVolume').addEventListener('input', (e)=>{
                    let v = parseFloat(e.target.value);
                    Music.setVolume(v);
                    document.getElementById('musicVolValue').innerText = v.toFixed(2);
                });
                document.getElementById('sfxVolume').addEventListener('input', (e)=>{
                    let v = parseFloat(e.target.value);
                    AudioSys.volume = v;
                    document.getElementById('sfxVolValue').innerText = v.toFixed(2);
                });
                document.getElementById('songSelect').addEventListener('change', (e)=>{
                    let idx = parseInt(e.target.value);
                    Music.loadSong(idx);
                });
                document.getElementById('soundEffects').addEventListener('change', (e)=>{
                    AudioSys.enabled = e.target.checked;
                });
                document.getElementById('bgMusicToggle').addEventListener('change', (e)=>{
                    if(e.target.checked) Music.play();
                    else Music.pause();
                });

                document.getElementById('pvpToggle').addEventListener('click', ()=>{
                    App.isPvP = !App.isPvP;
                    document.getElementById('pvpText').innerText = App.isPvP ? 'ÙˆØ¶Ø¹ AI' : 'ÙˆØ¶Ø¹ PvP';
                    document.getElementById('hintBtn').style.display = App.isPvP ? 'none' : 'inline-block';
                    resetGame();
                    addLog(App.isPvP ? 'ğŸ‘¥ PvP mode' : 'ğŸ¤– AI mode', 'sys');
                });

                document.getElementById('quickPlayBtn').addEventListener('click', ()=>{
                    document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                    document.querySelector('.level-btn[data-level="cosmic"]').classList.add('active');
                    App.currentLevel = 'cosmic';
                    resetGame();
                });

                document.getElementById('hintBtn').addEventListener('click', ()=>{
                    if(!App.gameActive || App.currentPlayer!=='X' || App.isPvP) return;
                    let best = getBestMove(9);
                    if(best!==-1) {
                        cells[best].style.boxShadow = 'inset 0 0 40px gold, 0 0 30px gold';
                        setTimeout(()=>cells[best].style.boxShadow='',2000);
                        App.hasUsedHint = true;
                        Missions.checkCondition('hint');
                    }
                });
                document.getElementById('resetBtn').addEventListener('click', resetGame);

                // Level buttons
                document.querySelectorAll('.level-btn[data-level]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        App.currentLevel = this.dataset.level;
                        if(!App.levelsTried.includes(App.currentLevel)) {
                            App.levelsTried.push(App.currentLevel);
                        }
                        addLog(`ğŸ® Ù…Ø³ØªÙˆÙ‰: ${App.currentLevel}`, 'sys');
                        resetGame();
                    });
                });

                // Tour buttons
                document.getElementById('tourNext').addEventListener('click', ()=> Tour.next());
                document.getElementById('tourPrev').addEventListener('click', ()=> Tour.prev());
                document.getElementById('tourSkip').addEventListener('click', ()=> Tour.hide());

                resetGame();
            }

            init();
        })();
    </script>
</body>
    </html>
